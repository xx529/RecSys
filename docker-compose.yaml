version: '2.6'

services:

  web:
    build:
      context: ./app/web
      dockerfile: Dockerfile
    image: "rec_sys-web:1.0"
    container_name: RecSys-web
    ports:
      - "8501:8501"
    volumes:
      - "/home/RecSys/app/web:/web"
    restart: always
    working_dir: /web
    command: streamlit run start.py
    depends_on: db

  alg:
    build:
      context: ./app/alg
      dockerfile: Dockerfile
    image: "rec_sys-alg:1.0"
    container_name: RecSys-alg
    ports:
      - "1729:5000"
    volumes:
      - "/home/RecSys/app/alg:/alg"
    restart: always
    working_dir: /alg
    command: echo "alg is ready"
    depends_on: db

  ctl:
    build:
      context: ./app/ctl
      dockerfile: Dockerfile
    image: "rec_sys-ctl:1.0"
    container_name: RecSys-ctl
    ports:
      - "5000:5000"
    volumes:
      - "/home/RecSys/app/ctl:/ctl"
    restart: always
    working_dir: /ctl
    command: echo "ctl is ready"
    depends_on: db

  db:
    image: "postgres:15beta1-bullseye"
    restart: always
    environment:
      - POSTGRES_USER=hang
      - POSTGRES_PASSWORD=12345
    container_name: RecSys-db
    ports:
      - "5432:5432"

  adminer:
    image: adminer
    restart: always
    ports:
      - "8080:8080"
    container_name: RecSys-dbadminer
    depends_on:
      - db